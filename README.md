# 서버 내 취약점 공격 및 방어 과제

---

GitHub repository 

[https://github.com/JoWoonJi/DirectoryListing-SQL_Injection](https://github.com/JoWoonJi/DirectoryListing-SQL_Injection)

링크 [https://github.com/JoWoonJi/DirectoryListing-SQL_Injection](https://github.com/JoWoonJi/DirectoryListing-SQL_Injection)

---

아이디어 정리

- [x]  디렉터리 리스팅 취약점 테스트 및 방어
- [x]  SQL Injection 테스트 및 방어
- [x]  유재욱 멘토님 코멘트대로 preapared statement에 대해 알아보기`escaping보단 pstmt와같이 원천방어할 수 있게 하는게 중요`
- [ ]  pstmt 적용해보기. 바드와 gpt를 활용해 보았지만 계속 에러가 나서 실패.

<aside>
💡 처음엔 SQL injection만 하려 했지만, 과제와 연결된 커리큘럼이 디렉터리 관련 취약점이라는 말을 듣고 추가로 시행하였다.

</aside>

---

# 1. Directory Listing

- URL에서 일정 부분을 지우고 접속하면 특정 디렉터리나 하위 디렉터리가 노출되게 되는데 이를 디렉터리 리스팅 공격이라고 한다. login_view.php 부분을 지우고 homepage 디렉터리에 접근이 되는지 테스트해 보자.

![글쓰기 구현 - 글등록 성공시.jpg](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%20%E1%84%82%E1%85%A2%20%E1%84%8E%E1%85%B1%E1%84%8B%E1%85%A3%E1%86%A8%E1%84%8C%E1%85%A5%E1%86%B7%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%80%E1%85%A7%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%87%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%A5%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A6%208693fc506c92432cb42e714eb800c980/%25EA%25B8%2580%25EC%2593%25B0%25EA%25B8%25B0_%25EA%25B5%25AC%25ED%2598%2584_-_%25EA%25B8%2580%25EB%2593%25B1%25EB%25A1%259D_%25EC%2584%25B1%25EA%25B3%25B5%25EC%258B%259C.jpg)

---

- 이처럼 디렉터리가 노출되게 되면 여러 문제가 발생하는데 공격자가 데이터를 그대로 탈취할 수도 있고 사진과 같이 db 부분의 원본 소스를 보게 된다면 루트 계정의 비밀번호가 그대로 노출 될 수도 있다.

![게시글 목록출력,글쓰기 버튼 클릭.jpg](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%20%E1%84%82%E1%85%A2%20%E1%84%8E%E1%85%B1%E1%84%8B%E1%85%A3%E1%86%A8%E1%84%8C%E1%85%A5%E1%86%B7%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%80%E1%85%A7%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%87%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%A5%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A6%208693fc506c92432cb42e714eb800c980/%25EA%25B2%258C%25EC%258B%259C%25EA%25B8%2580_%25EB%25AA%25A9%25EB%25A1%259D%25EC%25B6%259C%25EB%25A0%25A5%25EA%25B8%2580%25EC%2593%25B0%25EA%25B8%25B0_%25EB%25B2%2584%25ED%258A%25BC_%25ED%2581%25B4%25EB%25A6%25AD.jpg)

---

- 이제 디렉터리 리스팅 공격을 방어해보자. 아파치 웹서버를 활용하고 있으므로 httpd.conf 파일에서 indexes 지시자를 찾아 주석처리 해주거나 삭제해준다.

![DB 연결,저장 구현.jpg](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%20%E1%84%82%E1%85%A2%20%E1%84%8E%E1%85%B1%E1%84%8B%E1%85%A3%E1%86%A8%E1%84%8C%E1%85%A5%E1%86%B7%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%80%E1%85%A7%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%87%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%A5%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A6%208693fc506c92432cb42e714eb800c980/DB_%25EC%2597%25B0%25EA%25B2%25B0%25EC%25A0%2580%25EC%259E%25A5_%25EA%25B5%25AC%25ED%2598%2584.jpg)

---

- 디렉터리 리스팅 방어 성공. 똑같이 테스트 해 보면, 접근 권한이 없어 거부된 것이 보인다. indexes 지시자는 이렇게 하위 디렉터리 목록을 출력해주므로 삭제해주는 것이 좋고, FollowSymLinks 옵션만 삭제한다면 link 파일만 삭제되기 때문에 indexes지시자까지 삭제해줘야 한다.

![게시글 클릭시- 글읽기 구현 -조회수 기능.jpg](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%20%E1%84%82%E1%85%A2%20%E1%84%8E%E1%85%B1%E1%84%8B%E1%85%A3%E1%86%A8%E1%84%8C%E1%85%A5%E1%86%B7%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%80%E1%85%A7%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%87%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%A5%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A6%208693fc506c92432cb42e714eb800c980/%25EA%25B2%258C%25EC%258B%259C%25EA%25B8%2580_%25ED%2581%25B4%25EB%25A6%25AD%25EC%258B%259C-_%25EA%25B8%2580%25EC%259D%25BD%25EA%25B8%25B0_%25EA%25B5%25AC%25ED%2598%2584_-%25EC%25A1%25B0%25ED%259A%258C%25EC%2588%2598_%25EA%25B8%25B0%25EB%258A%25A5.jpg)

---

---

# 2. SQL Injection

- SQL injection은 가장 간단하지만 성공한다면 굉장히 큰 피해를 일으킨다. 그래서 웬만하면 다 보안코딩이 되어있지만, 사진처럼 허술한 페이지를 발견한다면 sql injection에 취약점이 있지 않은지 테스트 해 보자.

![1.SQL Injection test admin 입력하고 로그인해 보기.jpg](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%20%E1%84%82%E1%85%A2%20%E1%84%8E%E1%85%B1%E1%84%8B%E1%85%A3%E1%86%A8%E1%84%8C%E1%85%A5%E1%86%B7%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%80%E1%85%A7%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%87%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%A5%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A6%208693fc506c92432cb42e714eb800c980/1.SQL_Injection_test_admin_%25EC%259E%2585%25EB%25A0%25A5%25ED%2595%2598%25EA%25B3%25A0_%25EB%25A1%259C%25EA%25B7%25B8%25EC%259D%25B8%25ED%2595%25B4_%25EB%25B3%25B4%25EA%25B8%25B0.jpg)

---

- bool이 뜨며 로그인이 되지 않는다.

![2.bool이 뜨며 로그인이 되지 않는다.jpg](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%20%E1%84%82%E1%85%A2%20%E1%84%8E%E1%85%B1%E1%84%8B%E1%85%A3%E1%86%A8%E1%84%8C%E1%85%A5%E1%86%B7%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%80%E1%85%A7%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%87%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%A5%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A6%208693fc506c92432cb42e714eb800c980/2.bool%25EC%259D%25B4_%25EB%259C%25A8%25EB%25A9%25B0_%25EB%25A1%259C%25EA%25B7%25B8%25EC%259D%25B8%25EC%259D%25B4_%25EB%2590%2598%25EC%25A7%2580_%25EC%2595%258A%25EB%258A%2594%25EB%258B%25A4.jpg)

---

- 이제 SQL Injection 공격에 취약점이 있는지 테스트해 보자. SQL Injection의 대표적인 구문인 ‘ or ‘1’=’1 구문. 1=1은 반드시 참이고 or 이기때문에 sql 쿼리문을 비밀번호에 상관없이 무조건 참으로 만들어 준다.

![3.SQL injection의 대표적인 구문으로 관리자 계정을 탈취해보자.jpg](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%20%E1%84%82%E1%85%A2%20%E1%84%8E%E1%85%B1%E1%84%8B%E1%85%A3%E1%86%A8%E1%84%8C%E1%85%A5%E1%86%B7%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%80%E1%85%A7%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%87%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%A5%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A6%208693fc506c92432cb42e714eb800c980/3.SQL_injection%25EC%259D%2598_%25EB%258C%2580%25ED%2591%259C%25EC%25A0%2581%25EC%259D%25B8_%25EA%25B5%25AC%25EB%25AC%25B8%25EC%259C%25BC%25EB%25A1%259C_%25EA%25B4%2580%25EB%25A6%25AC%25EC%259E%2590_%25EA%25B3%2584%25EC%25A0%2595%25EC%259D%2584_%25ED%2583%2588%25EC%25B7%25A8%25ED%2595%25B4%25EB%25B3%25B4%25EC%259E%2590.jpg)

---

- bool이 뜨지 않고 SQL Injection 공격에 성공하여 admin(관리자)계정을 탈취하였다. 이처럼 간단한 공격이지만 관리자 계정을 탈취당할 위험이 있는 피해가 큰 공격이다.  사진처럼 adminpw!@#$ 비밀번호가 그대로 노출될 수도 있다.

![관리자 계정을 탈취하였다. 쿼리문에 비밀번호가 그대로노출될 수도 있다.jpg](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%20%E1%84%82%E1%85%A2%20%E1%84%8E%E1%85%B1%E1%84%8B%E1%85%A3%E1%86%A8%E1%84%8C%E1%85%A5%E1%86%B7%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%80%E1%85%A7%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%87%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%A5%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A6%208693fc506c92432cb42e714eb800c980/%25EA%25B4%2580%25EB%25A6%25AC%25EC%259E%2590_%25EA%25B3%2584%25EC%25A0%2595%25EC%259D%2584_%25ED%2583%2588%25EC%25B7%25A8%25ED%2595%2598%25EC%2598%2580%25EB%258B%25A4._%25EC%25BF%25BC%25EB%25A6%25AC%25EB%25AC%25B8%25EC%2597%2590_%25EB%25B9%2584%25EB%25B0%2580%25EB%25B2%2588%25ED%2598%25B8%25EA%25B0%2580_%25EA%25B7%25B8%25EB%258C%2580%25EB%25A1%259C%25EB%2585%25B8%25EC%25B6%259C%25EB%2590%25A0_%25EC%2588%2598%25EB%258F%2584_%25EC%259E%2588%25EB%258B%25A4.jpg)

---

- 실제 db 내 admin계정이 있고 비밀번호가 adminpw!@#$인 것을 확인 할 수 있다.

![DB 내 admin 계정 확인.jpg](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%20%E1%84%82%E1%85%A2%20%E1%84%8E%E1%85%B1%E1%84%8B%E1%85%A3%E1%86%A8%E1%84%8C%E1%85%A5%E1%86%B7%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%80%E1%85%A7%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%87%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%A5%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A6%208693fc506c92432cb42e714eb800c980/DB_%25EB%2582%25B4_admin_%25EA%25B3%2584%25EC%25A0%2595_%25ED%2599%2595%25EC%259D%25B8.jpg)

---

- id 와 pw를 바인딩하는 간단한 보안코딩을 적용해보자.

![6.id와 pw를 바인딩하여 간단한 보안코딩을 적용해보자.jpg](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%20%E1%84%82%E1%85%A2%20%E1%84%8E%E1%85%B1%E1%84%8B%E1%85%A3%E1%86%A8%E1%84%8C%E1%85%A5%E1%86%B7%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%80%E1%85%A7%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%87%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%A5%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A6%208693fc506c92432cb42e714eb800c980/6.id%25EC%2599%2580_pw%25EB%25A5%25BC_%25EB%25B0%2594%25EC%259D%25B8%25EB%2594%25A9%25ED%2595%2598%25EC%2597%25AC_%25EA%25B0%2584%25EB%258B%25A8%25ED%2595%259C_%25EB%25B3%25B4%25EC%2595%2588%25EC%25BD%2594%25EB%2594%25A9%25EC%259D%2584_%25EC%25A0%2581%25EC%259A%25A9%25ED%2595%25B4%25EB%25B3%25B4%25EC%259E%2590.jpg)

---

- 보안코딩 적용 후 다시 SQL Injection을 시도해보면 bool 이 뜨며 로그인이 되지 않고, 방어에 성공한 것이 확인된다.

![7.보안코딩적용 후 다시 인젝션 시도.jpg](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%20%E1%84%82%E1%85%A2%20%E1%84%8E%E1%85%B1%E1%84%8B%E1%85%A3%E1%86%A8%E1%84%8C%E1%85%A5%E1%86%B7%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%80%E1%85%A7%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%87%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%A5%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A6%208693fc506c92432cb42e714eb800c980/7.%25EB%25B3%25B4%25EC%2595%2588%25EC%25BD%2594%25EB%2594%25A9%25EC%25A0%2581%25EC%259A%25A9_%25ED%259B%2584_%25EB%258B%25A4%25EC%258B%259C_%25EC%259D%25B8%25EC%25A0%259D%25EC%2585%2598_%25EC%258B%259C%25EB%258F%2584.jpg)

![8.인젝션 방어 성공.jpg](%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%20%E1%84%82%E1%85%A2%20%E1%84%8E%E1%85%B1%E1%84%8B%E1%85%A3%E1%86%A8%E1%84%8C%E1%85%A5%E1%86%B7%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%80%E1%85%A7%E1%86%A8%20%E1%84%86%E1%85%B5%E1%86%BE%20%E1%84%87%E1%85%A1%E1%86%BC%E1%84%8B%E1%85%A5%20%E1%84%80%E1%85%AA%E1%84%8C%E1%85%A6%208693fc506c92432cb42e714eb800c980/8.%25EC%259D%25B8%25EC%25A0%259D%25EC%2585%2598_%25EB%25B0%25A9%25EC%2596%25B4_%25EC%2584%25B1%25EA%25B3%25B5.jpg)